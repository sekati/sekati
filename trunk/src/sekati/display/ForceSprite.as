/** * sekati.display.ForceSprite * @version 1.0.0 * @author jason m horwitz | sekati.com * Copyright (C) 2009  jason m horwitz, Sekat LLC. All Rights Reserved. * Released under the MIT License: http://www.opensource.org/licenses/mit-license.php */package sekati.display {	import flash.events.Event;		import sekati.events.FramePulse;		import sekati.display.InteractiveSprite;	import flash.geom.Rectangle;			/**	 * ForceSprite provides a <code>Sprite</code> which may have physics forces applied to it.	 */	public class ForceSprite extends InteractiveSprite {		protected var _boundRect : Rectangle;		protected var _speedX : Number;		protected var _speedY : Number;		protected var _accellerationX : Number;		protected var _accellerationY : Number;		protected var _friction : Number;		protected var _gravity : Number;		protected var _hasForce : Boolean;		/**		 * ForceSprite Constructor		 * @param bounds 	The bounds of movement for the object.		 * @param friction 	applied to the object.		 * @param gravity 	applied to the object.		 * @param hasForce 	whether the force is currently being applied.		 */		public function ForceSprite(bounds : Rectangle = null, friction : Number = 0.99, gravity : Number = 0.5, speed : Number = 30, hasForce : Boolean = true) {			super( );			if(bounds) {				this.bounds = bounds;				// constrain within bounds if the default position has overflow				if (x + width >= boundRight || x <= boundLeft) x = boundLeft;				if (y + height >= boundBottom || y <= boundTop) y = boundTop;			}			_speedX = speed;			_speedY = speed;			_accellerationX = 0;			_accellerationY = 0;			_friction = friction;			_gravity = gravity;			this.hasForce = hasForce;			interactiveMode = false;		}		/**		 * Handle force logic.		 */		private function frameHandler(e : Event) : void {				//trace( x + "," + y );			// each frame: add the necessary "forces" that moves the object.			_speedY += _gravity;			_speedY += _accellerationY;			_speedX += _accellerationX;			// each frame: decrease the speed, so the object won't bounce forever.			_speedY *= _friction;			_speedX *= _friction;						// place object			y += _speedY;			x += _speedX;								//Let's check when the ball hits the bottom.			if (y > boundBottom ) {				//When we hit the bottom, reposition the ball to be exactly on the				//bottom edge. Change the sign of the speedY so we go to the other direction.				y = boundBottom;				_speedY *= -1;			} else if (y < boundTop) {				//Check if the ball hits the top				y = 0;				_speedY *= -1;			}			//Check the right edge			if (x > boundRight) {				x = boundRight;				_speedX *= -1;			} else if (x < boundLeft) {				//Check the left edge				x = 0;				_speedX *= -1;			}		}									/**		 * Rectangle value relative to the coordinates of the Sprite's parent that specify a constraint area for the DraggableSprite.		 * <p>If <code>bounds</code> has not been set the <code>Canvas.stage</code> bounds are automatically implemented instead.</p>		 */		public function get bounds() : Rectangle {			return (_boundRect != null) ? _boundRect : new Rectangle( 0, 0, Canvas.stage.stageWidth, Canvas.stage.stageHeight );		}		/**		 * @private		 */		public function set bounds(r : Rectangle) : void {			_boundRect = r;		}		/**		 * Left bounds (<code>DisplayObject</code> registration <code>0,0</code>).		 */		public function get boundLeft() : Number {			return bounds.x;		}		/**		 * Right bounds (<code>DisplayObject</code> registration <code>0,0</code>).		 */		public function get boundRight() : Number {			return bounds.width - width;		}		/**		 * Top bounds (<code>DisplayObject</code> registration <code>0,0</code>).		 */		public function get boundTop() : Number {			return bounds.y;		}		/**		 * Bottom bounds (<code>DisplayObject</code> registration <code>0,0</code>).		 */		public function get boundBottom() : Number {			return bounds.height - height;		}		/**		 * <code>Boolean</code> value which determines whether the force is currently being applied. 		 */		public function get hasForce() : Boolean {			return _hasForce;		}		/**		 * @private		 */		public function set hasForce(b : Boolean) : void {			if(b && !_hasForce) {				FramePulse.$.addFrameListener( frameHandler );			} else if(!b && _hasForce) {				FramePulse.$.removeFrameListener( frameHandler );			}			_hasForce = hasForce;		}	}}